const rankingData = {
  meme: [
    {
      id: "meme-1",
      title: "1ìœ„ Â· ê³ ì–‘ì´ ë¦¬ì•¡ì…˜ ì§¤",
      summary: "ëŒ“ê¸€ ë°˜ì‘ì§¤ë¡œ ì¬ì‚¬ìš©",
      reason: "ê°ì • í‘œí˜„ì´ ì§ê´€ì ",
      origin: "êµ­ë‚´ ì»¤ë®¤ë‹ˆí‹°",
      format: "ì´ë¯¸ì§€/ì§¤",
      usage: "ëŒ“ê¸€ ë°˜ì‘, ìº¡ì…˜",
      people: "ì»¤ë®¤ë‹ˆí‹° ë°ˆ",
      links: [
        { label: "ì›ë³¸ ì´ë¯¸ì§€", url: "#" },
        { label: "ì‚¬ìš© ì˜ˆì‹œ", url: "#" },
        { label: "ì˜ìƒ ë³´ê¸°", url: "#" }
      ]
    },
    {
      id: "meme-2",
      title: "2ìœ„ Â· ì§§ì€ ë¬¸êµ¬ ë°ˆ",
      summary: "ìº¡ì…˜ ë°ˆìœ¼ë¡œ í™•ì‚°",
      reason: "ì¼ìƒ ê³µê° ìš”ì†Œ",
      origin: "SNS ìº¡ì…˜",
      format: "ë¬¸êµ¬/í…ìŠ¤íŠ¸",
      usage: "ìŠ¤í† ë¦¬/ëŒ“ê¸€",
      people: "SNS ë°ˆ",
      links: [
        { label: "ì›ë³¸ ì¶œì²˜", url: "#" },
        { label: "ì˜ìƒ ë³´ê¸°", url: "#" }
      ]
    },
    {
      id: "meme-3",
      title: "3ìœ„ Â· ë¹„êµ ì§¤ í…œí”Œë¦¿",
      summary: "í…œí”Œë¦¿ ê¸°ë°˜ ì¬ìƒì‚°",
      reason: "ì‰½ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥",
      origin: "ë°ˆ ì»¤ë®¤ë‹ˆí‹°",
      format: "í…œí”Œë¦¿",
      usage: "ë¹„êµ/íŒ¨ëŸ¬ë””",
      people: "ë°ˆ ì»¤ë®¤ë‹ˆí‹°",
      links: [
        { label: "í…œí”Œë¦¿", url: "#" },
        { label: "ì›ë³¸", url: "#" },
        { label: "ì˜ìƒ ëª¨ìŒ", url: "#" }
      ]
    }
  ],
  trend: [
    {
      id: "trend-1",
      title: "1ìœ„ Â· ë¯¸ë‹ˆ ì‹¤ë£¨ì—£ ìì¼“",
      summary: "ì…€ëŸ½ ì°©ìš© í›„ ìŠ¤ëƒ… ì‚¬ì§„ì´ ê¸‰ìƒìŠ¹",
      reason: "ì¸í”Œë£¨ì–¸ì„œ 3ëª…ì´ ë™ì‹œì— ì°©ìš©",
      price: "12~18ë§Œì›ëŒ€",
      where: "í¸ì§‘ìˆ/ë¸Œëœë“œëª°",
      people: "A ë°°ìš° Â· B ì•„ì´ëŒ",
      links: [
        { label: "êµ¬ë§¤ ë§í¬", url: "#" },
        { label: "ì°©ìš© ì‚¬ì§„", url: "#" },
        { label: "ë¦¬ë·° ì˜ìƒ", url: "#" }
      ]
    },
    {
      id: "trend-2",
      title: "2ìœ„ Â· ë‘ë°”ì´ ì«€ë“ì¿ í‚¤",
      summary: "ë¨¹ë°© ì˜ìƒì—ì„œ ê¸‰ìƒìŠ¹",
      reason: "ë¦¬ë·° ì½˜í…ì¸  í™•ì‚°",
      price: "2.5~4.0ë§Œì›",
      where: "ë² ì´ì»¤ë¦¬/íŒì—…",
      people: "í‘¸ë“œ í¬ë¦¬ì—ì´í„°",
      links: [
        { label: "êµ¬ë§¤ ë§í¬", url: "#" },
        { label: "ë¦¬ë·° ìš”ì•½", url: "#" },
        { label: "í›„ê¸° ì˜ìƒ", url: "#" }
      ]
    },
    {
      id: "trend-3",
      title: "3ìœ„ Â· ë¹ˆí‹°ì§€ ìŠ¤ë‹ˆì»¤ì¦ˆ",
      summary: "í•œì •íŒ ì¬ì¶œì‹œ í›„ ê²€ìƒ‰ëŸ‰ ìƒìŠ¹",
      reason: "ë¦¬ì…€ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ í™”ì œ",
      price: "24~32ë§Œì›",
      where: "ë¦¬ì…€/ê³µì‹ëª°",
      people: "ìŠ¤íŠ¸ë¦¿ ë¸Œëœë“œ",
      links: [
        { label: "íŒë§¤ì²˜", url: "#" },
        { label: "ì¶œì²˜", url: "#" },
        { label: "ë¦¬ë·° ì˜ìƒ", url: "#" }
      ]
    }
  ],
  challenge: [
    {
      id: "challenge-1",
      title: "1ìœ„ Â· 5ì´ˆ ì†ë™ì‘ ì±Œë¦°ì§€",
      summary: "ì‡¼ì¸ /ë¦´ìŠ¤ì—ì„œ ë°˜ë³µ ë…¸ì¶œ",
      reason: "ê°„ë‹¨í•œ ë™ì‘ì´ ë”°ë¼ í•˜ê¸° ì‰¬ì›€",
      sound: "ë¦¬ë¯¹ìŠ¤ ì‚¬ìš´ë“œ",
      how: "ì†ë™ì‘ 3ë‹¨ê³„",
      difficulty: "ì‰¬ì›€",
      people: "í¬ë¦¬ì—ì´í„° A",
      links: [
        { label: "ì›ë³¸ ì±Œë¦°ì§€", url: "#" },
        { label: "ì‚¬ìš© ìŒì›", url: "#" },
        { label: "ì˜ìƒ ì˜ˆì‹œ", url: "#" }
      ]
    },
    {
      id: "challenge-2",
      title: "2ìœ„ Â· ë¦¬ë¯¹ìŠ¤ ëŒ„ìŠ¤ ì±Œë¦°ì§€",
      summary: "ëŒ„ìŠ¤ ì˜ìƒì—ì„œ ê¸‰ìƒìŠ¹",
      reason: "ë¦¬ë¯¹ìŠ¤ ìŒì›ê³¼ ì„¸íŠ¸ë¡œ í™•ì‚°",
      sound: "90s ë¦¬ë¯¹ìŠ¤",
      how: "8ì¹´ìš´íŠ¸ ë£¨í‹´",
      difficulty: "ë³´í†µ",
      people: "ëŒ„ì„œ íŒ€ B",
      links: [
        { label: "ì±Œë¦°ì§€ ì˜ìƒ", url: "#" },
        { label: "ì›ê³¡ ì •ë³´", url: "#" },
        { label: "ì˜ìƒ ëª¨ìŒ", url: "#" }
      ]
    },
    {
      id: "challenge-3",
      title: "3ìœ„ Â· ì‚¬ìš´ë“œ ë°ˆ ì±Œë¦°ì§€",
      summary: "ì§§ì€ ë¦¬ì•¡ì…˜ ì‚¬ìš´ë“œ ì¬ì‚¬ìš©",
      reason: "ì§¤ê³¼ ê²°í•©ë˜ì–´ í™•ì‚°",
      sound: "3ì´ˆ ë¦¬ì•¡ì…˜ ì‚¬ìš´ë“œ",
      how: "í‘œì •/ëŒ€ì‚¬ ì‹±í¬",
      difficulty: "ì‰¬ì›€",
      people: "ìœ íŠœë²„ C",
      links: [
        { label: "ì›ë³¸ ì‚¬ìš´ë“œ", url: "#" },
        { label: "ì‚¬ìš© ì˜ˆì‹œ", url: "#" },
        { label: "í´ë¦½ ë³´ê¸°", url: "#" }
      ]
    }
  ]
};

const $slides = $(".slides");
const $slider = $(".slider");
const $dots = $(".dot");
const $rankingList = $("#ranking-list");
const $sheet = $("#detail-sheet");
const $sheetTitle = $("#sheet-title");
const $sheetBody = $("#sheet-body");
const $sheetLinks = $("#sheet-links");
const $linkModal = $("#link-modal");
const $modalConfirm = $("#modal-confirm");
const $modalCancel = $("#modal-cancel");
const $selectTrigger = $(".select-trigger");
const $selectMenu = $(".select-menu");
const $selectOptions = $(".select-option");
const $selectValue = $(".select-value");
const $nativeSelect = $("#ranking-criteria");
let pendingLink = null;

function renderRanking(category) {
  const items = rankingData[category];
  const tagMap = {
    meme: ["ì›ë³¸", "ìœ í–‰ ì´ìœ ", "ì‚¬ìš© ì˜ˆì‹œ"],
    trend: ["ê°€ê²©", "êµ¬ë§¤ì²˜", "ìœ í–‰ ì´ìœ "],
    challenge: ["ìŒì›", "ë£¨í‹´", "ë‚œì´ë„"]
  };
  const badgeMap = {
    meme: ["NEW", "ê¸‰ìƒìŠ¹", "ìœ ì§€"],
    trend: ["ê¸‰ìƒìŠ¹", "NEW", "í•˜ë½"],
    challenge: ["NEW", "ê¸‰ìƒìŠ¹", "ìœ ì§€"]
  };
  const html = items.map((item, index) => `
    <div class="rank-card" data-id="${item.id}" data-category="${category}">
      <div class="rank-title">
        <div class="rank-left">
          <span>${index + 1}ìœ„ Â· ${item.title.split("Â·")[1].trim()}</span>
          <span class="badge ${badgeMap[category][index] === "NEW" ? "new" : badgeMap[category][index] === "ê¸‰ìƒìŠ¹" ? "up" : badgeMap[category][index] === "í•˜ë½" ? "down" : ""}">${badgeMap[category][index]}</span>
        </div>
        <span>${index === 0 ? "ğŸ”¥" : index === 1 ? "â†—" : "â†”"}</span>
      </div>
      <div class="rank-meta">ìœ í–‰ ì´ìœ : ${item.reason}</div>
      <div class="rank-tags">
        ${tagMap[category].map((label) => `<span class="tag">${label}</span>`).join("")}
      </div>
    </div>
  `).join("");
  $rankingList.html(html);
}

function setSlide(index) {
  const clamped = (index + 3) % 3;
  $slider.attr("data-index", clamped);
  $slides.css("transform", `translateX(-${clamped * 100}%)`);
  $dots.removeClass("active");
  $dots.filter(`[data-index='${clamped}']`).addClass("active");
  const category = ["meme", "trend", "challenge"][clamped];
  renderRanking(category);
}

function openSheet(item) {
  const category = item.id.split("-")[0];
  $sheetTitle.text(item.title);
  if (category === "meme") {
    $sheetBody.html(`
      <div>ìš”ì•½: ${item.summary}</div>
      <div>ìœ í–‰ ì´ìœ : ${item.reason}</div>
      <div>í˜•ì‹: ${item.format}</div>
      <div>ì¶œì²˜: ${item.origin}</div>
      <div>ì‚¬ìš© ë§¥ë½: ${item.usage}</div>
    `);
  } else if (category === "trend") {
    $sheetBody.html(`
      <div>ìš”ì•½: ${item.summary}</div>
      <div>ìœ í–‰ ì´ìœ : ${item.reason}</div>
      <div>ê°€ê²©ëŒ€: ${item.price}</div>
      <div>êµ¬ë§¤/ì ‘ê·¼: ${item.where}</div>
      <div>ê´€ë ¨ ì¸ë¬¼: ${item.people}</div>
    `);
  } else {
    $sheetBody.html(`
      <div>ìš”ì•½: ${item.summary}</div>
      <div>ìœ í–‰ ì´ìœ : ${item.reason}</div>
      <div>ì‚¬ìš© ìŒì›: ${item.sound}</div>
      <div>ë£¨í‹´: ${item.how}</div>
      <div>ë‚œì´ë„: ${item.difficulty}</div>
    `);
  }
  $sheetLinks.html(item.links.map((link) => `
    <a href="${link.url}" target="_blank" rel="noopener">${link.label}</a>
  `).join(""));
  $sheet.addClass("active").attr("aria-hidden", "false");
}

$(document).on("click", ".nav-btn", function () {
  const dir = $(this).data("dir");
  const current = parseInt($slider.attr("data-index"), 10);
  setSlide(dir === "next" ? current + 1 : current - 1);
});

$(document).on("click", ".dot", function () {
  setSlide(parseInt($(this).data("index"), 10));
});

$(document).on("click", ".rank-card", function () {
  const category = $(this).data("category") || ["meme", "trend", "challenge"][parseInt($slider.attr("data-index"), 10)];
  const id = $(this).data("id");
  const item = rankingData[category].find((entry) => entry.id === id);
  if (item) {
    openSheet(item);
  }
});

$("#sheet-close").on("click", function () {
  $sheet.removeClass("active").attr("aria-hidden", "true");
});

$(document).on("click", "#sheet-links a", function (event) {
  event.preventDefault();
  pendingLink = $(this).attr("href");
  $linkModal.removeClass("is-hidden").attr("aria-hidden", "false");
});

function closeModal() {
  $linkModal.addClass("is-hidden").attr("aria-hidden", "true");
  pendingLink = null;
}

$modalCancel.on("click", closeModal);

$modalConfirm.on("click", function () {
  if (pendingLink) {
    window.open(pendingLink, "_blank", "noopener");
  }
  closeModal();
});

$linkModal.on("click", function (event) {
  if (event.target === this) {
    closeModal();
  }
});


$(document).on("click", ".select-trigger", function () {
  const isOpen = $(this).hasClass("is-open");
  $selectTrigger.toggleClass("is-open", !isOpen).attr("aria-expanded", String(!isOpen));
  $selectMenu.toggleClass("is-hidden", isOpen);
});

$(document).on("click", ".select-option", function () {
  const value = $(this).data("value");
  const label = $(this).text();
  $selectOptions.removeClass("selected");
  $(this).addClass("selected");
  $selectValue.text(label);
  $nativeSelect.val(value);
  $selectTrigger.removeClass("is-open").attr("aria-expanded", "false");
  $selectMenu.addClass("is-hidden");
});

$(document).on("click", function (event) {
  if (!$(event.target).closest(".select-wrap").length) {
    $selectTrigger.removeClass("is-open").attr("aria-expanded", "false");
    $selectMenu.addClass("is-hidden");
  }
});

setSlide(0);
